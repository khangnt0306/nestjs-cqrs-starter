import { Injectable, NotFoundException } from '@nestjs/common';
import { CommandHandler, ICommandHandler } from '@nestjs/cqrs';
import { Delete{{pascalCase name}}Command } from './delete-{{kebabCase name}}.command';
import { {{pascalCase name}}Repository } from '@infrastructure/repositories/{{kebabCase name}}.repository';

@CommandHandler(Delete{{pascalCase name}}Command)
@Injectable()
export class Delete{{pascalCase name}}Handler
  implements ICommandHandler<Delete{{pascalCase name}}Command, void>
{
  constructor(private readonly {{camelCase name}}Repository: {{pascalCase name}}Repository) {}

  async execute(command: Delete{{pascalCase name}}Command): Promise<void> {
    const { {{camelCase name}}Id } = command;

    // Find {{camelCase name}}
    const {{camelCase name}} = await this.{{camelCase name}}Repository.findOne({
      where: { id: {{camelCase name}}Id },
    });
    if (!{{camelCase name}}) {
      throw new NotFoundException(
        `{{pascalCase name}} with ID "${ {{~camelCase name~}} Id}" not found`,
      );
    }

    // Soft delete
    await this.{{camelCase name}}Repository.softRemove({{camelCase name}});
  }
}

