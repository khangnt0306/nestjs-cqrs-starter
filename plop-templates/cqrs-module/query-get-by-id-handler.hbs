import { Injectable, NotFoundException } from '@nestjs/common';
import { IQueryHandler, QueryHandler } from '@nestjs/cqrs';
import { Get{{pascalCase name}}ByIdQuery } from './get-{{kebabCase name}}-by-id.query';
import { {{pascalCase name}}Repository } from '@infrastructure/repositories/{{kebabCase name}}.repository';
import { {{pascalCase name}}ResponseDto } from '@shared/dtos/{{camelCase name}}s';

@QueryHandler(Get{{pascalCase name}}ByIdQuery)
@Injectable()
export class Get{{pascalCase name}}ByIdHandler
  implements IQueryHandler<Get{{pascalCase name}}ByIdQuery, {{pascalCase name}}ResponseDto>
{
  constructor(private readonly {{camelCase name}}Repository: {{pascalCase name}}Repository) {}

  async execute(query: Get{{pascalCase name}}ByIdQuery): Promise<{{pascalCase name}}ResponseDto> {
    const { {{camelCase name}}Id } = query;

    const {{camelCase name}} = await this.{{camelCase name}}Repository.findOne({
      where: { id: {{camelCase name}}Id },
    });

    if (!{{camelCase name}}) {
      throw new NotFoundException(
        `{{pascalCase name}} with ID "${ {{~camelCase name~}} Id}" not found`,
      );
    }

    return new {{pascalCase name}}ResponseDto({{camelCase name}});
  }
}

